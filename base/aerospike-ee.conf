# Aerospike database configuration file
# This template sets up a multi-node, single namespace developer environment.

# This stanza must come first.
service {
	cluster-name docker
}

logging {
	# Send log messages to stdout
	console {
		context any info
	}
}

network {
	service {
		address any
		port 3000
	}

	heartbeat {
		# mesh is used for environments that do not support multicast
		mode mesh
		# Use address any instead of local to allow external connections
		address any
		port 3002
		interval 150
		timeout 10
	}

	fabric {
		# Intra-cluster communication port (migrates, replication, etc)
		# Use address any instead of local to allow external connections
		address any
		port 3001
	}
}

namespace utxo-store {
    stop-writes-sys-memory-pct 90

    default-ttl           0
    nsup-period           120
    nsup-threads          1
    transaction-pending-limit 0

    replication-factor    1
    partition-tree-sprigs 4096

    storage-engine device {
        # for full IBD, direct disk access is preferred
        # device            /dev/nvme2n1  # replace nvme2n1 with your actual disk identifier

        # multiple devices is recommended
        file              /opt/aerospike/data/utxostore.dat
        filesize          1024G

        # for testing purposes you can also define a smaller file
        # file              /opt/aerospike/data/test.dat
        # filesize          100G

        flush-size 128K
        # Post-write cache to reduce I/O pressure (renamed from post-write-queue in v7.1)
        post-write-cache 256
        # Defrag settings - less aggressive to reduce write amplification
        defrag-lwm-pct 50
        defrag-sleep 2000
        # Eviction threshold
        evict-used-pct 70
        # Cache settings
        read-page-cache true
        # Maximum flush delay in milliseconds
        flush-max-ms 1000

        # high number to allow slow storage to keep up in case of traffic peaks
        # can be dangerous if the instance crashes or the storage can't keep up at all
        # monitor the queue with `asadm -e "show statistics like write_q"`
        max-write-cache 2048M
    }
}
